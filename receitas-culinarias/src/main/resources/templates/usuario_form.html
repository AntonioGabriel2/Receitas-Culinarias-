<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title th:with="isEdit=${#ctx.containsVariable('id')} ? (${id} != null) : false"
        th:text="${isEdit} ? 'Editar Usuário' : 'Cadastrar Usuário'">
    Usuário
  </title>
  <style>
    body{font-family:sans-serif;max-width:760px;margin:24px auto}
    label{display:block;margin-top:12px}
    input{width:100%;padding:8px;box-sizing:border-box}
    .erro{color:#b00020;font-size:.9rem}
    .actions{margin-top:16px}
  </style>
</head>
<body th:with="isEdit=${#ctx.containsVariable('id')} ? (${id} != null) : false">
  <h1 th:text="${isEdit} ? 'Editar Usuário' : 'Cadastrar Usuário'">Usuário</h1>

  <!-- 
    Se isEdit = true  -> POST /usuarios/{id}
    Se isEdit = false -> POST /usuarios
  -->
  <form th:action="${isEdit} ? @{/usuarios/{id}(id=${id})} : @{/usuarios}"
        th:object="${usuario}" method="post" novalidate>

    <!-- erros globais (ex.: br.reject(...)) -->
    <div class="erro" th:if="${#fields.hasGlobalErrors()}"
         th:each="e : ${#fields.globalErrors()}" th:text="${e}"></div>

    <label>Nome</label>
    <input th:field="*{nome}" placeholder="Ex.: Maria Silva" />
    <div class="erro" th:if="${#fields.hasErrors('nome')}" th:errors="*{nome}"></div>

    <label>CPF</label>
    <!-- fica readonly na edição -->
    <input th:field="*{cpf}" th:attr="readonly=${isEdit}"
           placeholder="Ex.: 123.456.789-09" />
    <div class="erro" th:if="${#fields.hasErrors('cpf')}" th:errors="*{cpf}"></div>

    <label>E-mail</label>
    <input th:field="*{email}" placeholder="Ex.: maria@exemplo.com" />
    <div class="erro" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>

    <label th:text="${isEdit} ? 'Senha (preencha para alterar)' : 'Senha'">Senha</label>
    <input type="password" th:field="*{senha}" placeholder="mín. 6 caracteres" />
    <div class="erro" th:if="${#fields.hasErrors('senha')}" th:errors="*{senha}"></div>

    <div class="actions">
      <button type="submit" th:text="${isEdit} ? 'Salvar alterações' : 'Cadastrar'">Salvar</button>
      <a th:href="@{/usuarios}" style="margin-left:8px">Cancelar</a>
    </div>
  </form>
</body>
</html>
